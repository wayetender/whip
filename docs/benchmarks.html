<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <title>Benchmarks - Whip</title> <meta name=description content="Describes how to run the Whip benchmarks from the ICFP paper."/> <link href="../assets/stylesheets/application-6771d460.css" rel=stylesheet /> <link rel=stylesheet href="//cdnjs.cloudflare.com/ajax/libs/hopscotch/0.2.6/css/hopscotch.min.css"> <meta name=viewport content="width=device-width, initial-scale=1.0"/> <link rel="shortcut icon" href="../assets/images/favicon-e9623b04.png"> <script src="//cdnjs.cloudflare.com/ajax/libs/hopscotch/0.2.6/js/hopscotch.min.js"></script> <script src="//use.typekit.net/kgv0shi.js"></script> <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script> <script>try{Typekit.load();}catch(e){}</script> </head> <body class="page-Benchmarks layout-docs page-sub"> <div id=header class="navigation navbar-static-top"> <div class=container> <div class=row> <div class=col-xs-12> <div class=navbar-header> <div class=navbar-brand> <a class=logo href="../index.html">Whip</a> </div> <button class="navbar-toggle white" type=button> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> </div> <div class="buttons hidden-xs"> <nav class=navigation-links role=navigation> <ul class="external-links white nav navbar-nav navbar-right"> <li class=github> <a href="https://github.com/wayetender/whip"><svg id=svg-download xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;"> <path d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9 c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2 c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2 c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1 c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/> </svg> GitHub</a> </li> </ul> <ul class="main-links white nav navbar-nav navbar-right"> <li class=li-under><a href="index.html">Documentation</a></li> </ul> <ul class="main-links white nav navbar-nav navbar-right"> <li class=li-under><a href="https://katacoda.com/wayetender/scenarios/whip-calculator-quickstart">Demo</a></li> </ul> </nav> </div> </div> </div> </div> </div> <div class=sidebar-overlay></div> <aside id=sidebar class="sidebar sidebar-default sidebar-fixed-right" role=navigation> <div class="sidebar-header header-cover"> <div class=sidebar-image> <img src="../assets/images/favicon-e9623b04.png" width=50px height=50px> </div> </div> <ul class="main nav sidebar-nav"> <li class=first><a href="https://katacoda.com/wayetender/scenarios/whip-calculator-quickstart">Demo</a></li> <li class=""><a href="index.html">Docs</a></li> <li class=github><a href="https://github.com/wayetender/whip"><svg id=svg-download xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;"> <path d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9 c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2 c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2 c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1 c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/> </svg> GitHub</a></li> </ul> <div class=divider></div> <ul class="external nav sidebar-nav"> <li class=""><a class="v-btn gray sml" href="/" %>GitHub</a></li> </ul> </aside> <div class=container> <div class=col-md-4> <div class="docs-sidebar hidden-print affix-top" role=complementary> <ul class="nav docs-sidenav"> <li> <a href="index.html">Home</a> </li> <li> <a href="getting-started.html">Getting Started</a> </li> <li class=active> <a href="benchmarks.html">Benchmarks</a> </li> </ul> </div> </div> <div id=main-content class=col-md-8 role=main> <div class=bs-docs-section> <h1 id=benchmarks> <a name=benchmarks class=anchor href="#benchmarks">&raquo;</a> Benchmarks </h1> <p>In this page we describe the benchmark suite of Whip, what it measures, and how to run these benchmarks locally.</p> <div class="alert alert-info" role=alert> <p><strong>Note:</strong> This page references details on the design of Whip without introduction. If you&#39;re unfamiliar with Whip, you may want to try the <a href="https://katacoda.com/wayetender/scenarios/whip-calculator-quickstart">Demo</a> first.</p> </div> <h2 id=overview> <a name=overview class=anchor href="#overview">&raquo;</a> Overview </h2> <p>Whip comes with a benchmark test suite that contains three real-world case studies. The case studies are:</p> <ul> <li><strong>Evernote</strong>: an Evernote Thrift API client. You can find more information about the Evernote API at <a href="https://dev.evernote.com/doc/">https://dev.evernote.com/doc/</a>. </li> <li><strong>Chess</strong>: a SOAP-based Xfcc correspondence chess program. You can find more information about the Xfcc protocol at <a href="http://xfcc.org/">http://xfcc.org/</a>. </li> <li><strong>Twitter</strong>: a REST-like Twitter API client. You can find more information about the Twitter API at <a href="https://dev.twitter.com/overview/api">https://dev.twitter.com/overview/api</a>. </li> </ul> <p>To evaluate how Whip impacts the performance of the services it enhances, we designed our benchmarks to analyze the time, memory, and network overhead due to Whip.</p> <h4 id=experimental-setup> <a name=experimental-setup class=anchor href="#experimental-setup">&raquo;</a> Experimental Setup </h4> <p>We do not use the actual third-party services for our experiments but instead mock their behavior, i.e., we simulate their behavior with pre-computed responses for each request. This is for two reasons:</p> <ol> <li>mocking services removes several sources of measurement noise, like service latency variation from background request load, and </li> <li>performing our experiments on third-party production servers violates their terms of use. </li> </ol> <p>We collect the following measurements for each test. First, we record the time to perform each request in the test suite and receive a reply for (1) the test client alone, and (2) the client enhanced with an adapter. The difference between these two measurements yields the latency due to the client’s adapter per request (adapter latency). Second, we record the amount of memory (RAM and hard-disk) used by the client’s adapter. Finally, we measure the adapter-to-adapter traffic (not including the original request or reply) in the TCP stream.</p> <p>Operations that identify a service entry always introduce the service entry (i.e., always use a new contract index and thus create new service entries in the adapters’ local state, which maximizes local state size).</p> <h2 id=running-the-benchmarks> <a name=running-the-benchmarks class=anchor href="#running-the-benchmarks">&raquo;</a> Running the Benchmarks </h2> <p>To run the benchmarks, you will need to have a recent version of Docker (at least version v1.13.0) installed on your computer. For instructions on downloading and installing Docker, please see <a href="https://www.docker.com/get-docker">https://www.docker.com/get-docker</a>.</p> <p>Once Docker is installed, you will need to clone the Whip repository and the directory we will be using is <code>benchmarks</code>. You can clone the repository and access that directory with the following two commands:</p> <pre class="highlight plaintext"><code>$ git clone https://github.com/wayetender/whip.git
Cloning into 'whip'...
...
$ cd whip/benchmarks  
</code></pre><h4 id=directory-structure> <a name=directory-structure class=anchor href="#directory-structure">&raquo;</a> Directory Structure </h4> <p>The <code>benchmarks</code> directory is structured as follows:</p> <pre class="highlight plaintext"><code>.
├── docker-compose.yml
├── README.md
├── evernote
│   └── ...
├── chess
│   └── ...
├── twitter
│   └── ...
└── parse_results
    └── ...
</code></pre><p>The benchmarks are run through <a href="https://docs.docker.com/compose/">Docker Compose</a>. The <code>docker-compose.yml</code> file describes the containers that will be run. In this suite, there are four containers:</p> <ul> <li><strong>evernote</strong>: the Evernote test benchmark </li> <li><strong>chess</strong>: the Chess test benchmark </li> <li><strong>twitter</strong>: the Twitter test benchmark </li> <li><strong>parse_results:</strong> produces human-readable plots from raw benchmark data </li> </ul> <h4 id=running-with-docker-compose> <a name=running-with-docker-compose class=anchor href="#running-with-docker-compose">&raquo;</a> Running with Docker Compose </h4> <p>To run the benchmarks, simply set the <code>NUM_OPS</code> environmental variable to the number of operations you want the benchmarks to perform and then run the <code>docker-compose up --build</code> command. The <code>docker-compose.yml</code> file is parameterized by the <code>NUM_OPS</code> variable, which sets the number of operations to run per benchmark. In the &quot;<a href="#anatomy-of-the-benchmarks">Anatomy of the Benchmarks</a>&quot; section, we describe the benchmark&#39;s operation in more detail.</p> <p>Below is an example run and its output with 3,000 operations per benchmark (9,000 operations in total).</p> <pre class="highlight shell"><code><span class="gp">$ </span><span class="nv">NUM_OPS</span><span class="o">=</span>3000 docker-compose up --build
Building parse_results
...
Attaching to benchmarks_parse_results_1, benchmarks_twitter_1, benchmarks_evernote_1, benchmarks_chess_1
evernote_1       | Starting tests
evernote_1       | Done
benchmarks_evernote_1 exited with code 0
chess_1          | Starting tests
chess_1          | Done
benchmarks_chess_1 exited with code 0
twitter_1        | Starting tests
twitter_1        | Done
benchmarks_twitter_1 exited with code 0
parse_results_1  | 
parse_results_1  | ---------------------------------
parse_results_1  |       Benchmarks Complete!       
parse_results_1  | ---------------------------------
parse_results_1  | 
parse_results_1  | Please check the results/images directory.
benchmarks_parse_results_1 exited with code 0
</code></pre><p>After running the benchmark, you can check the <code>results/images</code> directory inside the <code>benchmarks</code> directory to find the following generated images:</p> <div align=center> <p><img src="benchmarks_images/memorychart-81bf218b.png" alt="memorychart.png" style="width: 200px;"/> <img src="benchmarks_images/throughputchart-1d270d95.png" alt="throughputchart.png" style="width: 200px;"/> <img src="benchmarks_images/networkchart-cbf33840.png" alt=Drawing style="width: 200px;"/></p> </div> <ul> <li><p><a name=memorychart-png /><a href="#memorychart-png"><code>memorychart.png</code></a>: This chart shows the resident set size of the adapter and the dashed lines show the sizes of the store on disk. In general, the memory usage of the adapters should level off to be constant, while the store size (shown in dashed lines) should increase linearly.</p> </li> <li><p><a name=throughputchart-png /><a href="#throughputchart-png"><code>throughputchart.png</code></a>: This chart shows the latency of the adapter as the number of requests increases. Each point is the average of the 250 requests around it. In general, the latency of all three benchmarks should not increase as the number of requests increases. The variance, however, may be high depending on the Docker host machine setup.</p> </li> <li><p><a name=networkchart-png /><a href="#networkchart-png"><code>networkchart.png</code></a>: This chart shows the average amount of adapter traffic per operation call. Vertical bars indicate 95% confidence intervals. This chart should remain relatively fixed, with Evernote producing roughly 75 bytes of overhead on average per operation, and Twitter and Chess producing roughly 50 bytes of overhead per operation.</p> </li> </ul> <p>With the exception of the <code>networkchart.png</code> chart, the generated results will vary dramatically in absolute numbers depending on the number of resources given.</p> <div class="alert alert-info" role=alert> <p><strong>Note:</strong> In the ICFP paper, the number of operations chosen was 10,000 (i.e., <code>NUM_OPS=10000</code>). That trial will take about 45 minutes to an hour to complete, depending on the resources available to the Docker containers.</p> </div> <div class="alert alert-danger" role=alert> <p><strong>Warning:</strong> Due to bucketing of the raw output data, it is recommended to run the benchmarks with <strong>at least</strong> 500 operations per benchmark (i.e., <code>NUM_OPS=500</code>), otherwise there will not be enough aggregate data to plot an image.</p> </div> <h2 id=anatomy-of-the-benchmarks> <a name=anatomy-of-the-benchmarks class=anchor href="#anatomy-of-the-benchmarks">&raquo;</a> Anatomy of the Benchmarks </h2> <p>In this section, we describe the structure and operation of the benchmarks.</p> <p>Each benchmark has a common file structure, comprised of the following files:</p> <ul> <li><a name=dockerfile /><a href="#dockerfile"><code>Dockerfile</code></a>: This is the description of how to build the benchmark container. Each container starts from a base Whip container image, and installs benchmark-specific libraries and copies the source code needed to run the benchmark into the container. </li> <li><a name=run-sh /><a href="#run-sh"><code>run.sh</code></a>: This is the script that runs the benchmark. In general, the script will wait for a previous benchmark to complete, then start the server and adapter, then run the test client. Finally the raw benchmark telemetry is copied to the <code>results</code> volume. </li> <li><a name=server-py /><a href="#server-py"><code>server.py</code></a>: This file contains the mock server implementation and also starts the adapter in a subprocess (so that it can track its memory usage). </li> <li><a name=test-py /><a href="#test-py"><code>test.py</code></a>: This is the test client which which will initiate the client requests and track end-to-end latency. </li> <li><a name=adapter-yaml /><a href="#adapter-yaml"><code>adapter.yaml</code></a>: This is the Whip adapter configuration file. Inspect it to see what proxies are being set up and how the contracts are wired together to their network protocols. </li> <li><a name=benchmark_name-whip /><a href="#benchmark_name-whip"><code>{BENCHMARK_NAME}.whip</code></a>: This is the Whip contract file. </li> </ul> <div class="alert alert-warning" role=alert> <p><strong>Caution:</strong> For convenience, TLS verification has been disabled on the test clients as it can be difficult to install certificates on Docker hosts. For more information, see the <em><a href="https://docs.docker.com/engine/security/certificates/">Docker documentation on the topic</a></em>. Once the certificate is installed (and placed in the <code>server.pem</code> file for the mock server), you can remove the verification bypass options in the <code>test.py</code> file.</p> </div> <p>Each benchmark produces a variety of telemetry data, scattered between multiple programs. The raw data files are stored centrally in the <code>results</code> directory when the benchmark completes. Within each results subdirectory (given by the name of the benchmark), the following benchmark raw data files are created:</p> <ul> <li><a name=bytes /><a href="#bytes"><code>bytes</code></a>: Each line corresponds to the number of bytes of Whip-specific information in an enhanced message. The adapter computes this information (i.e., in <code>whip/src/adapter/proxy.py</code>) by computing the byte size difference between the original unenhanced message and the Whip-enhanced message. </li> <li><a name=clientcalls /><a href="#clientcalls"><code>clientcalls</code></a>: Each line corresponds to the number of milliseconds it took for a client request to complete from beginning to end. The <code>test.py</code> test client computes this information by measuring the delay of invoking an RPC. </li> <li><a name=memory /><a href="#memory"><code>memory</code></a>: Each line corresponds to a periodic reading of the adapter process&#39;s resident set size (memory usage) and the size of the store file. The file is comma separated and the columns are, in order, the memory usage of the adapter, the file size of the store file, and the number of requests received at the time of the reading. The <code>server.py</code> file computes this information. </li> <li><a name=times /><a href="#times"><code>times</code></a>: Each line corresponds to the number of milliseconds it took for the mock server to respond to a Whip-proxied request. It is similar to the data in the <code>clientcalls</code> file but is only the portion of time the Whip adapter spent waiting for the server to respond. The adapter computes this information by measuring the delay of invoking the RPC on the mock server while it is proxying a client request. </li> </ul> <p>With this information, the <code>parse_results</code> container uses the <code>parse.py</code> script to compute the final aggregated and joined data that makes up the resulting images (computed by the <code>gen_charts.sh</code> script).</p> </div> </div> </div> <div id=footer class=navigation> <div class=container> <div class=row> <div class=col-xs-12> <div> <ul class="main-links white nav navbar-nav"> <li><a href="https://katacoda.com/wayetender/scenarios/whip-calculator-quickstart">Demo</a></li> </ul> <ul class="main-links white nav navbar-nav"> <li><a href="index.html">Documentation</a></li> </ul> <ul class="external-links white nav navbar-nav"> <li class=github> <a href="https://github.com/wayetender/whip"><svg id=svg-download xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;"> <path d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9 c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2 c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2 c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1 c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/> </svg> GitHub</a> </li> </ul> <ul class="external-links white nav navbar-nav navbar-right"> <li><a href="https://github.com/wayetender/whip/blob/master/web/source/docs/benchmarks.md">Edit this page</a></li> </ul> </div> </div> </div> </div> </div> <script src="../assets/javascripts/application-d5bde7e6.js"></script> <!--[if lt IE 9]><script src="../assets/javascripts/ie-compat-c141a02d.js"></script><![endif]--> <script>
	APP.initialize();
</script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99314079-1', 'auto');
  ga('send', 'pageview');

</script> </body> </html>