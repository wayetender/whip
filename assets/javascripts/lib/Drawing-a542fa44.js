function init_whip_vis(e,t,a,r){var i={circleCount:4,tweens:[],adapters:[],outstandingPings:0,adapterColor:"rgba(255, 255, 255, 0.1)",nodeColor:"white",lineOpacity:.1,addServer:function(e,t){var a=new createjs.Shape;if(a.graphics.setStrokeStyle(3),a.graphics.beginStroke("#888"),a.graphics.beginFill(this.nodeColor).drawCircle(0,0,4),a.x=t.x,a.y=t.y,a.alpha=.5,this.stage.addChild(a),t.adapted){var r=new createjs.Shape;r.graphics.setStrokeStyle(1),r.graphics.beginStroke("#ccc"),r.graphics.beginFill(this.adapterColor).drawRect(-20,-20,40,40),r.x=t.x,r.y=t.y,r.alpha=1,this.adapters.push(r),this.stage.addChild(r)}},sendPing:function(e,t,a,r,i){for(var n,s=0;s<this.circleCount;s++){var c=new createjs.Shape;c.graphics.setStrokeStyle(1),c.graphics.beginStroke("#113355"),c.graphics.drawCircle(0,0,2*(s+1)),c.alpha=.8-.02*s,c.x=t,c.y=a,c.compositeOperation="lighter",this.stage.addChild(c),n=createjs.Tween.get(c).to({x:r,y:i},2500*(.5+.02*s)).to({alpha:0},300),0==s&&(n.first=!0),this.tweens.push(n)}return n},sendAvoidPing:function(e,t,a,r,i){for(var n,s=0;s<this.circleCount;s++){var c=new createjs.Shape;c.graphics.setStrokeStyle(3),c.graphics.beginStroke("#113355"),c.graphics.drawCircle(0,0,2*(s+1)),c.alpha=.8-.02*s,c.x=t,c.y=a,c.compositeOperation="lighter",this.stage.addChild(c),n=createjs.Tween.get(c).to({x:r,y:i},2500*(.5+.02*s)).to({alpha:0},300),c.checked=!0}return n},sendAvoidEnhancedPing:function(e,t,a,r,i){for(var n,s=0;s<this.circleCount;s++){var c=new createjs.Shape;c.graphics.setStrokeStyle(1),c.graphics.beginStroke("#113355"),c.graphics.drawCircle(0,0,2*(s+1)),c.alpha=.8-.02*s,c.x=t,c.y=a,c.compositeOperation="lighter",this.stage.addChild(c),n=createjs.Tween.get(c).to({x:r,y:i},2e4*(.5+.02*s)).to({alpha:0},300),0==s&&(n.first=!0),c.adapterx=r,c.adaptery=i,c.enhanced=!0,this.tweens.push(n)}return n},sendEnhancedPing:function(e,t,a,r,i){for(var n,s=0;s<this.circleCount;s++){var c=new createjs.Shape;c.graphics.setStrokeStyle(5),c.graphics.beginStroke("#00ff22"),c.graphics.drawCircle(0,0,2*(s+1)),c.alpha=.8-.02*s,c.x=t,c.y=a,c.compositeOperation="lighter",this.stage.addChild(c),n=createjs.Tween.get(c).to({x:r,y:i},2500*(.5+.02*s)).to({alpha:0},300),0==s&&(n.first=!0),this.tweens.push(n)}return n},sendCheckedPing:function(e,t,a,r,i){for(var n,s=0;s<this.circleCount;s++){var c=new createjs.Shape;c.graphics.setStrokeStyle(3),c.graphics.beginStroke("#113355"),c.graphics.drawCircle(0,0,2*(s+1)),c.alpha=.8-.02*s,c.x=t,c.y=a,c.compositeOperation="lighter",this.stage.addChild(c),n=createjs.Tween.get(c).to({x:r,y:i},2e3*(.5+.05*s)).to({alpha:0},300),c.checked=!0}return n},sendPings:function(e,t){var a=t[Math.floor(Math.random()*t.length)],r=t[Math.floor(Math.random()*t.length)];if(a==r)this.sendPings(e,t);else{var i=this;a.adapted&&r.adapted?this.sendAvoidEnhancedPing(e,a.x,a.y,r.x,r.y):a.adapted&&!r.adapted?this.sendAvoidPing(e,a.x,a.y,r.x,r.y).call(function(){i.outstandingPings--}):this.sendPing(e,a.x,a.y,r.x,r.y).call(function(){i.outstandingPings--})}},drawLines:function(e,t){for(var a in t)for(var r in t)if(a!=r){var i=t[a],n=t[r],s=new createjs.Shape;s.graphics.setStrokeStyle(1),s.graphics.beginStroke("#ddd"),s.alpha=this.lineOpacity,s.graphics.moveTo(i.x,i.y),s.graphics.lineTo(n.x,n.y),s.graphics.endStroke(),e.addChild(s)}}};r||(r={}),r.nodeColor&&(i.nodeColor=r.nodeColor),r.lineOpacity&&(i.lineOpacity=r.lineOpacity),i.stage=new createjs.Stage(a),i.drawLines(i.stage,e);for(var n in e){var s=e[n];i.addServer(i.stage,s)}return createjs.Ticker.setFPS(10),createjs.Ticker.addEventListener("tick",function(a){if(i.outstandingPings<t){i.outstandingPings++;var r=e;setTimeout(function(){i.sendPings(i.stage,r)},2e3*Math.random())}for(var n in i.tweens){var s=i.tweens[n];if(0!=s.target.alpha&&!s.target.checked){var c=!1;for(var o in i.adapters){var h=i.adapters[o],d=s.target.localToLocal(0,0,h);h.hitTest(d.x,d.y)&&(s.target.enhanced?c=!0:(createjs.Tween.get(s.target,{override:!0}).to({x:s.target.x,y:s.target.y,alpha:0}),s.first&&i.sendCheckedPing(i.stage,s.target.x,s.target.y,h.x,h.y).call(function(){i.outstandingPings--}),s.target.checked=!0))}s.target.enhanced&&!c&&(createjs.Tween.get(s.target,{override:!0}).to({x:s.target.x,y:s.target.y,alpha:0}),s.first&&i.sendEnhancedPing(i.stage,s.target.x,s.target.y,s.target.adapterx,s.target.adaptery),s.target.checked=!0)}}for(var n=0;n<i.tweens.length;n++)i.tweens[n].target.checked&&(i.tweens.splice(n,1),n++);i.stage.update(a)}),i}